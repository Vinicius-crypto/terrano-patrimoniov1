{% extends "base.html" %}

{% block title %}Editar Equipamento - {{ equipamento.id_publico }}{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <div class="bg-white rounded-lg shadow-md p-6">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold text-gray-800">
                ‚úèÔ∏è Editar Equipamento: {{ equipamento.id_publico }}
            </h2>
            <a href="{{ url_for('consulta') }}" class="text-green-600 hover:text-green-800">
                ‚Üê Voltar para Consulta
            </a>
        </div>

        <form method="POST" enctype="multipart/form-data" class="space-y-6">
            
            <!-- Informa√ß√µes B√°sicas -->
            <div class="border-b pb-4">
                <h3 class="text-lg font-semibold text-gray-700 mb-4">üìã Informa√ß√µes B√°sicas</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            Tipo *
                        </label>
                        <input type="text" 
                               name="tipo" 
                               value="{{ equipamento.tipo }}"
                               required
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            Marca
                        </label>
                        <input type="text" 
                               name="marca" 
                               value="{{ equipamento.marca or '' }}"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            Modelo
                        </label>
                        <input type="text" 
                               name="modelo" 
                               value="{{ equipamento.modelo or '' }}"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            N√∫mero de S√©rie
                        </label>
                        <input type="text" 
                               name="num_serie" 
                               value="{{ equipamento.num_serie or '' }}"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500">
                    </div>
                </div>
            </div>

            <!-- Localiza√ß√£o e Responsabilidade -->
            <div class="border-b pb-4">
                <h3 class="text-lg font-semibold text-gray-700 mb-4">üìç Localiza√ß√£o e Responsabilidade</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            Localiza√ß√£o
                        </label>
                        <input type="text" 
                               name="localizacao" 
                               value="{{ equipamento.localizacao or '' }}"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            Status *
                        </label>
                        <select name="status" 
                                required
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500">
                            <option value="Estocado" {% if equipamento.status == 'Estocado' %}selected{% endif %}>Estocado</option>
                            <option value="Em uso" {% if equipamento.status == 'Em uso' %}selected{% endif %}>Em uso</option>
                            <option value="Manuten√ß√£o" {% if equipamento.status == 'Manuten√ß√£o' %}selected{% endif %}>Manuten√ß√£o</option>
                            <option value="Descartado" {% if equipamento.status == 'Descartado' %}selected{% endif %}>Descartado</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            Respons√°vel
                        </label>
                        <input type="text" 
                               name="responsavel" 
                               value="{{ equipamento.responsavel or '' }}"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            SPE
                        </label>
                        <input type="text" 
                               name="SPE" 
                               value="{{ equipamento.SPE or '' }}"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500">
                    </div>
                </div>
            </div>

            <!-- Informa√ß√µes Financeiras -->
            <div class="border-b pb-4">
                <h3 class="text-lg font-semibold text-gray-700 mb-4">üí∞ Informa√ß√µes Financeiras</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            Valor (R$)
                        </label>
                        <input type="number" 
                               name="valor" 
                               step="0.01"
                               value="{{ equipamento.valor or '' }}"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            Data de Aquisi√ß√£o
                        </label>
                        <input type="date" 
                               name="data_aquisicao" 
                               value="{{ equipamento.data_aquisicao.strftime('%Y-%m-%d') if equipamento.data_aquisicao else '' }}"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500">
                    </div>
                </div>
            </div>

            <!-- Manuten√ß√£o -->
            <div class="border-b pb-4">
                <h3 class="text-lg font-semibold text-gray-700 mb-4">üîß Manuten√ß√£o</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            √öltima Manuten√ß√£o
                        </label>
                        <input type="date" 
                               name="ultima_manutencao" 
                               value="{{ equipamento.ultima_manutencao.strftime('%Y-%m-%d') if equipamento.ultima_manutencao else '' }}"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500">
                    </div>
                </div>
            </div>

            <!-- Observa√ß√µes -->
            <div class="border-b pb-4">
                <h3 class="text-lg font-semibold text-gray-700 mb-4">üìù Observa√ß√µes</h3>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                        Observa√ß√µes
                    </label>
                    <textarea name="observacoes" 
                              rows="3"
                              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500">{{ equipamento.observacoes or '' }}</textarea>
                </div>
            </div>

            <!-- Imagem -->
            <div class="border-b pb-4">
                <h3 class="text-lg font-semibold text-gray-700 mb-4">üì∑ Imagem</h3>
                
                {% if equipamento.imagem_url %}
                <div class="mb-4">
                    <p class="text-sm text-gray-600 mb-2">Imagem atual:</p>
                    <img src="{{ equipamento.imagem_url }}" 
                         alt="{{ equipamento.tipo }}" 
                         class="max-w-xs rounded-lg shadow">
                </div>
                {% endif %}
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">
                        Atualizar Imagem
                    </label>
                    <input type="file" 
                           name="imagem" 
                           accept="image/*"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500">
                    <p class="text-xs text-gray-500 mt-1">Formatos: PNG, JPG, JPEG, GIF (m√°x. 5MB)</p>
                </div>
            </div>

            <!-- Bot√µes -->
            <div class="flex justify-between items-center pt-4">
                <a href="{{ url_for('consulta') }}" 
                   class="px-6 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition">
                    Cancelar
                </a>
                
                <div class="space-x-3">
                    {% if current_user.nivel_acesso >= 3 %}
                    <button type="button" 
                            onclick="confirmarExclusao('{{ equipamento.id_publico }}')"
                            class="px-6 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition">
                        üóëÔ∏è Excluir
                    </button>
                    {% endif %}
                    
                    <button type="submit" 
                            class="px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition">
                        üíæ Salvar Altera√ß√µes
                    </button>
                </div>
            </div>
        </form>

        <!-- Informa√ß√µes de Auditoria -->
        {% if equipamento.created_at or equipamento.updated_at %}
        <div class="mt-6 pt-6 border-t text-sm text-gray-500">
            <h4 class="font-semibold text-gray-700 mb-2">üìä Informa√ß√µes de Auditoria</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                {% if equipamento.created_at %}
                <div>
                    <strong>Criado em:</strong> {{ equipamento.created_at.strftime('%d/%m/%Y %H:%M') }}
                    {% if equipamento.criado_por %}
                    por {{ equipamento.criado_por.username }}
                    {% endif %}
                </div>
                {% endif %}
                
                {% if equipamento.updated_at %}
                <div>
                    <strong>√öltima atualiza√ß√£o:</strong> {{ equipamento.updated_at.strftime('%d/%m/%Y %H:%M') }}
                    {% if equipamento.editado_por %}
                    por {{ equipamento.editado_por.username }}
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Script para confirma√ß√£o de exclus√£o -->
<script>
function confirmarExclusao(idPublico) {
    if (confirm('‚ö†Ô∏è ATEN√á√ÉO! Tem certeza que deseja excluir o equipamento ' + idPublico + '?\n\nEsta a√ß√£o n√£o pode ser desfeita!')) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '/equipamento/' + idPublico + '/excluir';
        document.body.appendChild(form);
        form.submit();
    }
}
</script>
{% endblock %}
